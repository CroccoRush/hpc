# Отчет по заданию: Вычисление матричного выражения с использованием OpenMP

## Введение

В данном задании была разработана программа на языке C++ для вычисления матричного выражения вида:

$$ A = B \cdot C^3 + \text{Tr}(C) \cdot I + C + \text{Tr}(B) \cdot E ,$$

где:
- $` B `$ и $` C `$ — квадратные плотные матрицы, элементы которых имеют тип `double`.
- $` I `$ — единичная матрица.
- $` E `$ — матрица, все элементы которой равны единице.
- $` \text{Tr}(B) `$ и $` \text{Tr}(C) `$ — следы матриц $` B `$ и $` C `$ соответственно.

Программа была распараллелена с использованием OpenMP с применением 
директив `parallel`, `task` и `sections`(не реализовано). 
Задача также включала исследование масштабируемости параллельной версии программы 
в зависимости от размера матриц и количества потоков, а также проверку закона Амдала.

## Характеристики сервера

Вычисления производились на сервере со следующими характеристиками:

- **Количество CPU:** 12
- **Модель CPU:** Intel(R) Xeon(R) E-2136 CPU @ 3.30GHz
  - *Архитектура:* x86_64
  - *Физических ядер:* 6

## Реализация

### C++ Код

Программа на C++ включает в себя класс `Matrix`, который реализует основные операции с матрицами, 
такие как сложение, умножение, возведение в степень и вычисление следа. 
Основная функция `calculate_expression` вычисляет матричное выражение в соответствии с заданной формулой.

Распараллеливание выполнено с использованием OpenMP с применением 
директив `parallel`, `task` и `sections`(не реализовано). В зависимости от выбранного типа вычислений 
(`simple`, `tasks`, `sections`(не реализовано)), программа использует различные стратегии параллелизации.

### Python Код

Python-скрипт используется для автоматизации запуска программы на C++ с различными параметрами 
(размер матрицы, количество потоков, тип вычислений) и для анализа результатов. Скрипт собирает данные 
о времени выполнения и вычисляет среднее значение и дисперсию для каждого набора параметров.

После сбора данных, скрипт строит графики зависимости среднего времени выполнения 
и ускорения от количества потоков для различных размеров матриц.

## Результаты

### Графики

Графики, созданные на основе результатов вычислений, сохранены в папке `./imgs`. Они включают:

1. **Зависимость среднего времени выполнения от количества потоков:**
    - Показывает, как время выполнения программы изменяется в зависимости от количества потоков 
      для различных размеров матриц.

2. **Зависимость ускорения от количества потоков:**
    - Показывает, как ускорение (отношение времени выполнения на одном потоке к времени выполнения 
      на нескольких потоках) изменяется в зависимости от количества потоков. А так же представлена прямая 
      теоретического ускорения для закона Амдала. 

На графиках отдельно отмечены вертикальные линии там, где количество потоков равняется $`(x * \text{CORES\_COUNT})`$.
Их смысл будет описан в разделе "Анализ".

### Анализ

#### Масштабируемость

Программа демонстрирует хорошую масштабируемость для матриц всех размеров, 
однако для матриц разных размеров пик ускорения достигаются при использовании разного количества потоков.
Это можно объяснить тем, что для малых матриц накладные расходы на управление потоками и синхронизацию 
могут превышать выигрыш от параллелизации. Для больших матриц, где вычислительная нагрузка значительно выше, 
эти накладные расходы становятся менее значимыми, и ускорение достигает максимума при использовании 
большего количества потоков.

#### Закон Амдала 

На графиках ускорения видно, что ускорение стремится к теоретическому пределу, 
заданному законом Амдала, однако при большом количестве потоков оно выходит на плато.
Это связано с тем, что доля последовательного кода в программе ограничивает общее ускорение, 
несмотря на увеличение количества потоков.

Так же стоит отметить, что при количестве потоков равном $`(x * \text{CORES\_COUNT} + 1)`$ 
ускорение значительно проседает. Это может быть связано с увеличением накладных расходов на коммуникацию 
между разными CPU, а так же на возможное наличие логических ядер, количество которых кратно превышает 
количество физических ядер у процессоров. В результате, не все потоки могут быть эффективно распределены 
по независимым ядрам процессоров, что приводит к снижению производительности. Данный эффект лучше заметен 
на небольших матрицах, где затраты на коммуникацию сильно влияют на производительность.

## Заключение

В результате выполнения задания была разработана и распараллелена программа для вычисления матричного выражения 
с использованием OpenMP. Проведенные эксперименты показали эффективность параллельной версии программы и 
частично подтвердили теоретические предположения о масштабируемости и законе Амдала.

## Приложение

- **Исходный код:** [C++](./main.cpp), [Python](./agregator.py)
- **Результаты:** [CSV](./results)
- **Графики:** [PNG](./imgs_saves)

---

**Автор:** Киселев Владимир Александрович, группа М.71-мм

**Дата:** 25.11.2024